syntax = "proto3";
package potato.schematic.proto;

message Field
{
    string name = 1;
    uint32 type = 2;
    repeated Annotation annotations = 3;
}

message EnumItem
{
    string name = 1;
    uint32 type = 2;
    repeated Annotation annotations = 3;

    int64 value = 10;
}

message Annotation
{
    uint32 attribute_type = 1;
}

message Type
{
    message Aggregate
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        optional uint32 base_type = 10;
        repeated Field fields = 11;
    }

    message Bool
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;
    }

    message Int
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        uint32 width = 10;
        bool signed = 11;
    }

    message Float
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        uint32 width = 10;
    }

    message String
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;
    }

    message Enum
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        optional uint32 base_type = 10;
        repeated EnumItem items = 11;
    }

    message Array
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        uint32 element_type = 10;
        optional uint32 size = 11;
    }

    message TypeRef
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;
    }

    message Polymorphic
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        uint32 type = 10;
        bool nullable = 11;
    }

    message Attribute
    {
        string name = 1;
        uint32 module = 2;
        repeated Annotation annotations = 3;

        repeated Field fields = 10;
    }

    oneof Types
    {
        Aggregate aggregate = 1;
        Bool bool = 2;
        Int int = 3;
        Float float = 4;
        Array array = 5;
        String string = 6;
        Enum enum = 7;
        TypeRef type = 8;
        Polymorphic polymorphic = 9;
        Attribute attribute = 10;
    }
}

message Module
{
    string filename = 1;
    repeated uint32 imports = 2;
}

message Schema
{
    repeated Module modules = 1;
    repeated Type types = 2;
    uint32 root_module = 3;
}
